笔记来源于bilibili湖科大教书匠的计算机网络微课堂：[计算机网络微课堂（有字幕无背景音乐版）_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1c4411d7jb?spm_id_from=333.999.0.0)

# 1. 概述

## 1.1 计算机网络在信息时代的作用

- 计算机网络已由一种**通信基础设施**发展成为一种重要的**信息服务基础设施**



## 1.2 因特网概述

1. 网络、互联网（互连网）和因特网
2. 因特网发展的三个阶段
3. 因特网的标准化工作
4. 因特网的组成



### 1.2.1 网络、互联网（互连网）和因特网

- 网络（Network）由若干**结点**（Node）和连接这些结点的**链路**（Link）组成。
- 多个网络还可以通过路由器互连起来，这样就构成了一个覆盖范围更大的网络，即互联网。因此，互连网是==网络的网络（Network of Networks）==
- 因特网（Internet）是世界上最大的互联网络（用户数以亿计，互联的网络数以百万计）。

![image-20220303114832186](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802220.png)

![image-20220303114953856](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802222.png)

**internet与Internet的区别：**

- internet（互连网或互联网）：是一个通用名词，它泛指由多个计算机网络互连而成的网络。在这些网络之间的通信协议可以是任意的。
- Internet（因特网）：是一个专用名词，它指当前全球最大的，开放的，由众多网络相互连接而成的特定计算机网络，它采用TCP/IP协议族做成通信的规则，其前身是美国的ARPANET。



### 1.2.2 因特网发展的三个阶段

1. 1969：从单个网络ARPANET向互联网发展
   1. 1969年，第一个分组交换网==ARPANET==
   2. 70年代中期，研究多种网络之间的互连
   3. 1983年，==TCP/IP协议==成为ARPANET的标准协议（因特网诞生时间）
2. 1985：逐步建成三级网络的因特网
   1. 1985年，NSF围绕六个大型计算机中心建设==NSFNET==（主干网、地区网和校园网）
   2. 1990年，ARPANET任务完成，正式关闭
   3. 1991年，美国政府将因特网主干网交给私人公司经营，并开始对接入因特网的单位收费
3. 1993年：逐步形成了多称此ISP结构的因特网
   1. 1993年，NSFNET逐渐被若干个商用因特网主干网代替；政府机构不再负责因特网运营，让各种==因特网服务提供者ISP（Internet Service Provider）==来运营
   2. 1994年，==万维网WWW技术==促使因特网迅猛发展
   3. 1995年，NSFNET停止运作，==因特网彻底商业化==



**因特网服务提供者==ISP：==**

我国主要的ISP：中国电信，中国联通，中国移动

![image-20220303115405114](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802223.png)

**基于ISP的三层结构的因特网：**

![image-20220303115523150](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802224.png)



### 1.2.3 因特网的标准化工作

- 因特网的标准化工作对因特网的发展起到了非常重要的作用
- 因特网在指定其标准上的一个很大的特点是==面向公众==
  - 因特网所有的RFC(Request For Comments)技术文档都可以从因特网上免费下载；（http://www.ietf.org/rfc.html)
  - 任何人都可以随时用电子邮箱发表对某个文档的意见或建议
- ==因特网协会ISOC==是一个国际性组织，她负责对因特网进行全面管理，以及在世界范围内促进其发展和作用
  - 因特网体系结构委员会IAB，负责管理因特网有关协议的开发
  - 因特网工程部IETF，负责研究中短期工程问题，主要针对协议的开发和标准化
  - 因特网研究部IRTF，从事理论方面的研究和开发一些需要长期考虑的问题
- 制定因特网的正式标准要经过以下4个阶段：
  1. 因特网草案（在这个阶段还不是RFC文档）
  2. 建议标准（从这个阶段开始就成为RFC文档）
  3. 草案标准
  4. 因特网标准

![image-20220303120222745](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802225.png)

### 1.2.4 因特网的组成

- 边缘部分

  由所有连接在因特网上的==主机==组成。这部分是==用户直接使用==的，用来进行==通信==（传送数据、音频或视频）和==资源共享==

- 核心部分

  由==大量网络==和连接这些网络的==路由器==组成，这部分是==为边缘部分提供服务==的（提供连通性和交换）

![image-20220303120517240](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802226.png)



## ※1.3 三种交换方式

1. 电路交换（Circuit Switching）
2. 分组交换（Packet Switching）
3. 报文交换（Message Switching）



### 1.3.1 电路交换（Circuit Switching）

想要让所有的电话机都两两相连接是不现实的，若有n部电话机要两两相连，则需要n(n-1)/2 条电线，显然这样是不合理的，于是出现了电话交换机，它相当于一个中间枢纽，将所有电话连接起来。

![image-20220303122359120](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802227.png)

- 电话交换机接通电话线的方式称为电路交换
- 从通信资源的分配角度来看，交换（Switching）就是按照某种方式动态地分配传输线路地资源
- 电路交换地三个步骤：
  1. 建立连接（分配通信资源）
  2. 通话（一直占用通信资源）
  3. 释放连接（归还通信资源）

![image-20220303121547014](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802228.png)

**当使用电路交换来传送计算机数据时，其线路的传输效率往往很低**



### 1.3.2 分组交换（Packet Switching）

- 发送方：构造分组，发送分组
- 路由器：缓存分组，转发分组
- 接收方：接收分组，还原报文

> 在因特网中，最重要的==分组交换机==就是==路由器==，她负责将各种网络互联起来，并对接收到的分组进行转发（分组交换）

假设用户H6想要发送一条消息（报文）给用户H2，利用分组交换实现：

1. 把较长的报文分成更短的等长数据段
2. 在数据段的前面，加上一些由必要的控制信息组成的==首部==（包含了分组的目的地址）后，构成一个分组（包）
3. 各分组经过分组交换机的存储转发（可能会出现分组丢失，误码，重复等问题），最终到达主机H2
4. 主机H2接收到分组后，去掉它们的首部，将各数据段组合还原出原始报文

示意图：

![](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/Snipaste_2022-03-03_12-40-42.png)

![image-20220303124344894](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802229.png)

![image-20220303124719724](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802230.png)



### 1.3.3 报文交换（Message Switching）

报文交换中的交换结点也采用存储转发方式，但报文交换对报文的大小没有限制，这就要求交换结点需要较大的缓存空间。报文交换主要用于早期的电报通信网，现在较少使用，**通常被较先进的分组交换方式所取代**。

### 1.3.4 三种交换方式的对比

![image-20220303125018412](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802231.png)

优缺点对比：

| 交换方式 | 优点                                                         | 缺点                                                         |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 电路交换 | 通信时延小；有序传输；没有冲突；适用范围广；实时性强；控制简单 | 建立连接时间长；线路独占，使用效率低；灵活性差；难以规格化   |
| 报文交换 | 无需建立连接；动态分配线路；提高线路可靠性与利用率；提供多目标服务 | 引起了转发延时；需要较大存储缓存空间；需要传输额外的信息量   |
| 分组交换 | 无需建立连接；线路利用率高；简化了存储管理；加速传输；减少出错率和重发数据量 | 引起了转发时延；需要传输额外的信息量；对于数据报服务，存在失序、丢失或者重复分组的问题；对于虚电路服务，存在呼叫建立，数据传输和虚电路释放三个过程 |



## 1.4 计算机网络的定义和分类

### 1.4.1 计算机网络的定义

- 计算机网络的精准定义并未统一
- 计算机网络的最简单的定义是：一些==互==相==连==接、==自治==的计算机的==集合==
  - 互连：指计算机之间可以通过有线或无线的方式进行数据通信
  - 自治：指独立的计算机，它有自己的硬件和软件，可以单独运行使用
  - 集合：指至少需要两台计算机
- 计算机网络的较好的定义是：计算机网络主要是由一些==通用的，可编程的硬件互连==而成的，而这些硬件并非专门用来实现某-特定目的(例如，传送数据或视频信号)。这些可编程的硬件能够用来==传送多种不同类型的数据==， 并能==支持广泛的和日益增长的应用==。
  - 计算机网络所连接的硬件，并不限于一般的计算机，而是包括了智能手机等智能硬件。
  - 计算机网络并非专门用来传送数据，而是能够支持很多种的应用(包括今后可能出现的各种应用)。



### 1.4.2 计算机网络的分类

**按交换技术分类**：

- 电路交换网络
- 报文交换网络
- 分组交换网络

**按使用者分类**：

- 公用网
- 专用网

**按传输介质分类**：

- 有线网络
  1. 同轴电缆：成本低，安装方便，但传输率低，抗干扰能力一般，传输距离短
  2. 双绞线：组建局域网时常用，优缺点类似于同轴电缆
  3. 光纤：主要用于网络的主干部分，其特点是成本高，安装技术要求高，传输距离长，传输率高，抗干扰能力强，且不会受到电子监听设备的监听等，是组建高安全性网络的理想选择
- 无线网络
  1. 红外线
  2. 微波
  3. 无线电

**按覆盖范围分类**：

- 广域网WAN
  1. 属于一个组织，一个单位或一个部门所有
  2. 网络一般不对外提供公共服务，管理方便，安全保密性高
  3. 组建方便，投资少，见效快，使用灵活应用最普遍的计算机网络
- 城域网MAN
  1. 一般是一个地区或一个城市
- 局域网LAN
  1. 小到一个地区，一个城市，大到一个国家，几个国家乃至全世界
  2. 提供大范围的公共服务。因特网就是典型的广域网
  3. 与局域网相比，广域网投资大，安全保密性差，传输速率慢
- 个域网PAN
  1. 个人工作的地方把个人使用的电子设备用无线技术连接起来的网络


**按拓扑结构分类**：

- 总线型网络

  ![image-20220610212220950](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/image-20220610212220950.png)

- 星型网络

  ![image-20220610212236198](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/image-20220610212236198.png)

- 环形网络

  ![image-20220610212252260](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/image-20220610212252260.png)

- 网状型网络

  ![image-20220610212309762](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/image-20220610212309762.png)



## ※1.5 计算机网络的性能指标

- 性能指标可以从不同的方面来度量计算机网络的性能
- 常用的计算机网络的性能值表有以下8个：
  - 速率
  - 带宽
  - 吞吐量
  - 时延
  - 时延带宽积
  - 往返时间
  - 利用率
  - 丢包率

### 1.5.1 速率

**比特：**计算机中==数据量的单位==，也是信息论中信息量的单位。一个比特就是二进制数字中的一个1或0。

**常用数据量单位：**

8 bit = 1 Byte

**KB** = **2<sup>10</sup> B**

**MB** = K · KB = 2<sup>10</sup> · 2<sup>10</sup> B = **2<sup>20</sup> B**

**GB** = K · MB = 2<sup>10</sup> · 2<sup>20</sup> B = **2<sup>30</sup> B**

**TB** = K · GB = 2<sup>10</sup> · 2<sup>30</sup> B = **2<sup>40</sup> B**



**速率：**连接在计算机网络上的主机在数字信道上传送比特的速率，也成为==比特率==或==数据率==

**常用数据率单位：**

bit/s (b/s, bps)

**kb/s** = **10<sup>3</sup>** b/s (bps)

**Mb/s** = k · kb/s = 10<sup>3</sup> · 10<sup>3</sup> b/s = **10<sup>6</sup>** b/s(bps)

**Gb/s** = k · Mb/s = 10<sup>3</sup> · 10<sup>6</sup> b/s = **10<sup>9</sup>** b/s(bps)

**Tb/s** = k · Gb/s = 10<sup>3</sup> · 10<sup>9</sup> b/s = **10<sup>12</sup>** b/s(bps)



常见数据量和数据率的例子：

1. 有一个待发送的数据块，大小为==100 MB==，网卡的发送速率为==100 Mbps==，则网卡发送完该数据块需要多长时间?

   ![image-20220303135028874](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802232.png)

2. 主机甲通过1个路由器(存储转发方式)与主机乙互联，两段链路的数据传输速率均为`10 Mbps`，主机甲分别采用==报文交换==和分组大小为`10 kb`的==分组交换==向主机乙发送1个大小为`8 Mb` (1Mb=10^6^b）的报文。若忽略链路传播延迟、分组头开销和分组拆装时间，则两种交换方式完成该报文传输所需的总时间分别为多少？

   解：（1）不进行分组时，发送一个报文的时延是$\frac{8 Mb}{10 Mb/s}$= 800 ms，在接收端接收此报文件的时延也是800 ms，共计1 600 ms。

   （2）进行分组后，发送一个报文的时延是$\frac{10 kb}{10Mb/s}$= 1 ms， 接收一个报文的时延也是1 ms，但是在发送第二个报文时，第一个报文已经开始接收。共计有8Mb/10kb=800个分组，总时间为801 ms。



### 1.5.2 带宽

**带宽在模拟信号系统中的意义：**

- ==信号==所包含的各种不同频率成分所占据的==频率范围==
- 单位：Hz (kHz, MHz, GHz)

**带宽在计算机网络中的意义：**

- 用来表示网络的==通信线路==所能传送数据的能力，因此网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的==最高数据率==
- 单位：b/s (kb/s, Mb/s, Gb/s, Tb/s)

> 其实，==带宽==的这两种表述之间有着密切的联系。一条通信线路的==频带宽度==越宽，其所传输数据的==最高数据率==也越高



### 1.5.3 吞吐量

- 吞吐量表示在==单位时间内通过某个网络（或信道、接口）的数据量==
- 吞吐量被经常用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络
- 吞吐量==受网络的带宽或额定速率的限制==



### 1.5.4 时延

![image-20220303142145068](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802233.png)

**网络时延分为三种：**

1. 发送时延：$\frac{分组长度（b）}{发送速率（b/s）}$

2. 传播时延：$\frac{信道长度（m）}{电磁波传播速率（m/s）}$

   不同传播材质的电磁波传播速率：

   - 自由空间：3×10^8^ m/s
   - 铜线：2.3×10^5^ m/s
   - 光纤：2.0×10^8^ m/s

3. 处理时延：一般不方便计算

发送时延和传播时延哪个占据主导呢？我们通过以下两个例子来探讨：

![image-20220303142735026](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802234.png)

可以得出结论：在处理时延不计的情况下，发送时延和传播时延都有可能占据主导，所以需要具体问题具体分析。



### 1.5.5 时延带宽积

**时延带宽积 = 传播时延 × 带宽**

![image-20220303143139024](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802235.png)

> 若发送端连续发送数据，则在所发送的第一个比特即将到达终点时，发送端就已经发送了时延带宽积个比特

> 链路的时延带宽积又称为==以比特为单位的链路长度==



### 1.5.6 往返时间

- 在许多情况下，因特网上的信息不仅仅单方向传输，而是双向交互
- 我们有时很需要知道双向交互一次所需的时间
- 因此，往返时间RTT(Round-Trip Time)也是一个重要的性能指标



过程示意图：

以太网上的用户要和无线局域网中的用户进行信息交互：

![image-20220303143843448](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802236.png)

往返时间RTT是指从源主机发送分组开始，直到源主机接收来自目的主机的==确认分组==为止，所需要的时间。

![image-20220303144521370](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802237.png)

![image-20220303144747415](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802238.png)

![image-20220303145002183](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802239.png)

> 在以上传输过程中，是在以太网上耗时较多，还是在无线局域网上耗时较多，还是在卫星链路上耗时较多？
>
> 答案是在卫星链路上耗时较多。一般情况下，卫星链路的距离比较远，所带来的传播时延比较大。



### 1.5.7 利用率

> 信道利用率：用来表示某信道有百分之几的时间是被利用的（有数据通过）
>
> 网络利用率：全网络的信道利用率的加权平均

- 根据排队论，当某信道的利用率增大时，该信道引起的时延也会迅速增加，因此，==信道利用率并非越高越好==

- 如果令Do表示网络空闲时的时延，D表示网络当前的时延，那么在适当的
  假定条件下，可以用下面的简单公式来表示D、Do和利用率U之间的关系：
                                          D=$\frac{Do}{1-U}$

  - 当网络的利用率达到50%时，时延就要加倍

  - 当网络的利用率超过50%时，时延急剧增大

  - 当网络的利用率接近100%时，时延就趋于无穷大

  - 因此，一些拥有较大主干网的ISP通常会控制它们的信道利用率
    不超过50%。如果超过了，就要准备扩容，增大线路的带宽

    ![image-20220303150537799](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802240.png)

- 也不能使信道利用率太低，这会使宝贵的通信资源被白白浪费。应该使用
  一些机制，可以根据情况动态调整输入到网络中的通信量，使网络利用率
  保持在一个合理的范围内。



### 1.5.8 丢包率

- 丢包率即分组丢失率，是指在一定的时间范围内，传输过程中==丢失的分组数量与总分组数量的比率==
- 丢包率具体可分为接口丢包率、结点丢包率、链路丢包率、路径丢包率、网络丢包率等
- 丢包率是网络运维人员非常关心的一个网络性能指标，但对于普通用户来说往往并不关心这个指标，因为他们通常意识不到网络丢包

> 分组丢失主要有两种情况：
>
> - 分组在传输过程中出现==误码==，被结点丢弃
> - 分组到达一台队列已满的分组交换机时被丢弃，在通信量较大时就可能造成==网络拥塞==

**因此，丢包率反应了网络的拥塞情况**：

- 无拥塞时路径丢包率为0
- 轻度拥塞时路径丢包率为1%~4%
- 严重拥塞时路径丢包率为5%~15%



## ※1.6 计算机网络体系结构

### 1.6.1 常见的计算机网络体系结构

- OSI体系结构：==法律==上的国际标准
- TCP/IP体系结构：==事实==上的国际标准
- 原理体系结构：适于教学

![image-20220303191010994](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802241.png)

![image-20220303191348507](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802242.png)



### 1.6.2 分层的必要性

- ==计算机网络是个非常复杂的系统==。早在最初的ARPANET设计时就提出了分层的设计理念
- "==分层=="可将庞大而复杂的问题，转化为若干个较小的局部问题，而这些较小的局部问题就比较易于研究和处理
- 下面，我们按照由简单到复杂的顺序，来看看实现计算机网络要面临哪些主要的问题，以及如何将这些问题划分到相应的层次，层层处理



**物理层主要讨论：**

![image-20220303192007700](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802243.png)

> **严格来说，传输媒体不包含在物理层和体系结构之中**
>
> **网络的传输信号也不是上图中的方波信号**
>
> 仅是为了让教学更易于理解



**数据链路层主要讨论：**

![image-20220303192722212](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802244.png)

**网络层主要讨论：**

![image-20220303193113201](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802245.png)



**运输层主要讨论：**

![image-20220303193150629](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802246.png)

**应用层主要讨论：**

![image-20220303193248787](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802247.png)

**总览：**

![image-20220303193332861](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802248.png)



### 1.6.3 分层思想举例

主机和Web服务器之间基于网络的通信，实际上是主机中的浏览器应用进程与Web服务器中的Web服务器应用进程之间基于网络的通信。

那么，体系结构的各层，在整个过程中起到怎样的作用呢？接下来就让我们一起来探讨探讨吧！



==主机端==发送一段信息，从自顶向下的顺序来看：

1. 应用层：按HTTP协议的规定，==构建一个HTTP请求报文==，然后将HTTP请求报文交付给运输层处理
2. 运输层：给HTTP请求报文添加一个==TCP首部==（区分应用进程，实现可靠传输），使之成为==TCP报文段==，然后将TCP报文段交付给网络层处理
3. 网络层：给TCP报文段添加一个==IP首部==（使IP数据报可以在互连网上传输，也就是被路由器转发），使之成为==IP数据报==，然后将IP数据报交付给数据链路层处理
4. 数据链路层：给IP数据报添加一个==首部==（让帧能够在一段链路上或一个网络上传输，能够被相应的目的主机接收）和一个==尾部==（让目的主机检查所接收到的帧是否有误码），使之成为==帧==，然后将帧交付给物理层处理
5. 物理层：将帧看作是==比特流==，由于网络N1是以太网，因此会给比特流前面添加==前导码==（让目的主机做好接收帧的准备），然后将添加有前导码的比特流变换成相应的信号，发送到传输媒体

信号通过传输媒体到达==路由器==后，从自下而上的顺序来看：

1. 物理层：将信号变换为比特流，然后去掉前导码，将其交付给数据链路层，这实际上交付的是帧
2. 数据链路层：将帧的首部和尾部去掉后，将其交付给网络层，这实际上交付的是IP数据报
3. 网络层：解析IP数据报的首部，从中提取出目的网络地址，然后查找自身的路由表，确定转发端口（以便进行转发），然后将IP数据报交付给数据链路层

在路由器到达网络层后，又反过来向下传输：

1. 数据链路层：给IP数据报添加一个首部和一个尾部，使之成为帧，然后将帧交付给物理层处理
2. 物理层：将帧看作是比特流，由于网络N2是以太网，因此会给比特流前面添加前导码（让目的主机做好接收帧的准备），然后将添加有前导码的比特流变换成相应的信号，发送到传输媒体

信号通过传输媒体到达==Web服务器==后，从自下而上的顺序来看：

1. 物理层：将信号变换为比特流，然后去掉前导码，将其交付给数据链路层，这实际上交付的是帧
2. 数据链路层：将帧的首部和尾部去掉后，将其交付给网络层，这实际上交付的是IP数据报
3. 网络层：将IP数据报的首部去掉后，将其交付给运输层，这实际上交付的是TCP报文段
4. 运输层：将TCP报文段的首部去掉后，将其交付给应用层，这实际上交付的是HTTP请求报文
5. 应用层：对HTTP请求报文进行解析，然后给主机发回HTTP相应报文



接下来的过程与之前的类似：

HTTP响应报文需要在Web服务器层层封装，然后通过物理层变换成相应的信号，在通过传输媒体传输到路由器，路由器转发该响应报文给主机，主机通过物理层将接收到的信号准换为比特流，之后通过层层封装，最终取出HTTP响应报文。



**整体的过程如下图所示：**

![Snipaste_2022-03-03_21-29-18](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802249.png)

![image-20220303213415609](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802250.png)



### 1.6.4 专用术语

#### 1）实体

> - 实体：任何可发送或接收信息的==硬件==或==软件进程==
> - 对等实体：收发双方==相同层次中的实体==

![image-20220303213657726](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802251.png)

#### 2）协议

> - 协议：控制两个对等实体进行==逻辑通信==（实际并不存在）的规则的集合
> - 协议的三要素：
>   - 语法：定义所交换信息的格式（TCP/IP协议，HTTP协议等）
>   - 语义：定义收发双方所要完成的操作（主机发送请求，Web服务器响应请求）
>   - 同步：定义收发双方的时序关系



两个对等实体进行==逻辑通信==：

![image-20220303214213356](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802252.png)

协议的同步：

​		TCP采用 “三报文握手” 建立连接的过程如下图，通过该图可以看出TCP客户端和TCP服务器之间的时序关系

![image-20220303215141628](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802253.png)



#### 3）服务

> - 在协议的控制下，两个对等实体间的逻辑通信使得本层能够向上一层提供服务
> - 要实现本层协议，还需要使用下面一层所提供的服务
> - 协议是 “==水平的==” ，服务是 “==垂直的==”
> - 实体看得见相邻下层所提供的服务，但并不知道实现该服务的具体协议。也就说，下面的协议对上面的实体是"==透明=="的

![image-20220610223106637](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/image-20220610223106637.png)



**服务访问点：**在同一系统中==相邻两层的实体交换信息的逻辑接口==，用于区分不同的服务类型

- 数据链路层的服务访问点为帧的 “类型” 字段。
- 网络层的服务访问点为IP数据报首部中的 “协议字段” 。
- 运输层的服务访问点为 “端口号” 。

**服务原语：**上层使用下层所提供的服务必须通过与下层==交换一些命令==，这些命令成为服务原语

![image-20220303215820927](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802256.png)



**协议数据单元PDU：**==对等层次之间传送的数据报==称为该层的协议数据单元

**服务数据单元SDU：**==同一系统内，层与层之间交换的数据包==称为服务数据单元

**多个SDU可以合成为一个PDU；一个SDU也可以划分为几个PDU**（因为有时SDU较长，而协议所要求的PDU较短。这时就要对SDU进行分段处理，将一个SDU分成两个或多个PDU来传送；当PDU所要求的长度比SDU还大时，也可将几个SDU合并成为一个PDU）

![image-20220303220117291](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802257.png)



## 1.7 章节总结 --- 思维导图

![](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251818700.png)





# 2. 物理层

## 2.1 物理层的基本概念

- 物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流
- 物理层为数据链路层屏蔽了各种传输媒体的差异，使数据链路层只需要考虑如何完成本层的协议和服务，而不必考虑网络具体的传输媒体是什么。

![image-20220304134758719](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802258.png)

**物理层协议的主要任务：**

- 机械特性：指明接口所用接线器的==形状==和==尺寸==、==引脚数目==和==排列==、==固定==和==锁定==装置。
- 电器特性：指明在接口电缆的各条线，上出现的==电压的范围==。
- 功能特性：指明某条线上出现的某一电平的==电压表示何种意义==。
- 过程特性：指明对于不同功能的各种可能==事件的出现顺序==。



## 2.2 物理层下面的传输媒体（了解）

### 2.2.1 导引型传输媒体

#### 同轴电缆

- 基带同轴电缆（50Ω）：数字传输，过去用于局域网
- 带宽同轴电缆（75Ω）：模拟传输，目前主要用于有线电视

**同轴电缆价格较贵且布线不够灵活和方便，随着集线器的出现，在局域网领域基本上都是采用双绞线作为传输媒体。**

![image-20220304141105277](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802259.png)

#### 双绞线

- 绞合的作用
  - 抵御部分来自外界的电磁波干扰
  - 减少相邻导线的电磁干扰

![image-20220304141632592](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802260.png)

#### 光纤

- 纤芯直径
  - 多模光纤：50微米，62.5微米
  - 单模光纤：9微米
- 包层直径：125微米
- 工作波长
  - 0.85微米（衰减较大）
  - 1.30微米（衰减较小）
  - 1.55微米（衰减较小）
- 优点
  - 通信容量大（25000~30000GHz的带宽）
  - 传输损耗小，远距离传输时更加经济。
  - 抗雷电和电磁干扰性能好。这在大电流脉冲干扰的环境下尤为重要。
  - 无串音干扰，保密性好，不易被窃听。
  - 体积小，重量轻。
- 缺点：割接需要专用设备；光电接口价格较贵

![image-20220304142137102](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802261.png)



**光在光纤中传输的基本原理：**

光纤的组成：

![image-20220304142642074](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802262.png)

光在光纤中的传输：

- 当光从==高折射率==的媒体射==向低折射率==的媒体时，其==折射角将大于入射角==
- 因此，如果==入射角足够大==，就会出现==全反射==，即光碰到包层时，就会反射回纤芯

![image-20220304142440326](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802263.png)



**多模光纤：光在纤芯中的传输方式是==不断地全反射==**

**单模光纤：光在纤芯中==一直向前传播而不发生全反射==**

![image-20220304143453761](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802264.png)



#### 电力线

![image-20220304143826206](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802265.png)



### 2.2.2 非导引型传输媒体

我们可以利用电磁波在自由空间地传播来传送数据信息

![image-20220304144711218](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802266.png)

#### 无线电波和微波

![image-20220304144854517](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802267.png)

![image-20220304144947005](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802268.png)

![image-20220304145021526](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802269.png)



#### 红外线

- 点对点无线传输
- 直线传输，中间不能有障碍物，传输距离短
- 传输速率低(4Mb/s~1 6Mb/s)

![image-20220304145139516](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802270.png)

#### 可见光

LED照明光无线通信在国外也还处在起步和摸索阶段，如果两个房间内的网络设备要基于LiFi通信，如何做到可见光的同步？目前还在研发阶段，但其应用前景非常看好。



## 2.3 传输方式

### 2.3.1 串行传输和并行传输

- 串行传输：数据是一个比特一个比特依次发送的，因此，在发送端和接收端之间，只需要一条数据传输线即可
- 并行传输：一次发送n个比特而不是一个比特，因此，在发送端和接收端之间需要有n条传输线路
  - 优点：速度为从串行传输的n倍
  - 缺点：成本高

![image-20220304150317791](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802271.png)



### 2.3.2 同步传输和异步传输

==同步传输==时，接收端在每个比特信号的中间时刻进行检测，以判别接收到的是比特0还是1。由于不同设备的时钟频率存在一定差异，不可能做到完全相同，在传输大量数据过程中，所产生的判别时刻的累计误差，会导致接收端对比特信号的判别错位。因此需要采取方法使收发双方的时钟保持同步。

![image-20220304151053822](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802272.png)

### 2.3.3 单项通信(单工)，双向交替通信(半双工)和双向同时通信(全双工)

![image-20220304151302079](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802273.png)



## 2.4 编码与调制

![image-20220304152345114](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802274.png)

**码原：**在使用时间域的波形表示数字信号时，==代表不同离散数值的基本波形==。

![image-20220304152450070](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802275.png)

**传输媒体和信道的关系：**严格来说，传输媒体和信道不能之间划等号

![image-20220304153033623](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802276.png)

### 2.4.1 常用编码

#### 不归零编码：

![image-20220304193409272](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802277.png)

![image-20220304193607784](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802278.png)

#### 归零编码：

![image-20220304193641705](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802279.png)

#### 曼彻斯特编码：

![image-20220304193733968](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802280.png)

#### 差分曼彻斯特编码：

![image-20220304193806097](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802281.png)

例题：![image-20220304193931867](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802282.png)



### 2.4.2 基本调制方法

![image-20220304194020765](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802283.png)



**使用基本调制方法，1个码元只能包含1个比特信息。为了能使1个码原包含更多的比特，可以采用==混合调制方法==**



### 2.4.3 混合调制方法

![image-20220304194427846](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802284.png)

![image-20220304194839074](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802285.png)



## ※2.5 信道的极限容量

### 2.5.1 失真

![image-20220304195158760](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802286.png)

失真的因素：

- 码元传输速率
- 信号传输距离
- 噪声干扰
- 传输媒体质量



### 2.5.2 奈氏准则

![image-20220304195354474](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802288.png)

### 2.5.3 香浓公式

![image-20220304195425089](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802289.png)



**综合来看奈氏准则和香浓公式**

![image-20220304195559893](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802290.png)



例题：

![image-20220304195634774](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802291.png)



![image-20220304195819727](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802292.png)

![image-20220304195917791](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802293.png)

![image-20220304195834139](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802294.png)



## 2.6 章节总结 --- 思维导图

![](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251815108.png)









# 3. 数据链路层

## 3.1 数据链路层概述

- ==链路==(Link) 就是从一个结点到相邻结点的一段物理线路，而中间没有任何其他的交换结点
- ==数据链路==(Data Link) 是指把实现通信协议的硬件和软件加到链路上，就构成了数据链路
- 数据链路层以==帧==为单位传输和处理数据

![image-20220315102331727](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802295.png)



### 3.1.1 数据链路层的三个重要问题

==**下面使用点对点信道的数据链路层举例**：==

> 封装成帧

![image-20220315103459469](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802296.png)



> 差错检测

封装好的帧通过物理层发送到传输媒体，帧在传输过程中可能会出现误码。

为了让接收方在接收到帧的时候能够发现传输过程中是否出现了误码，发送方在发送帧之前，会基于待发送的数据和检错算法计算出检错码，并将其封装在帧尾。

![image-20220315103712794](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802297.png)



接收方可以通过检错码来发现帧在传输过程中出现了误码，

![image-20220315104308541](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802298.png)



> 可靠传输

在接收方发现接收到的是**有误码的帧**时，会直接将其**丢弃**：

- 如果数据链路层向其上层提供的是**不可靠服务**，那么丢弃了就丢弃了，不会有更多的措施
- 如果数据链路层向其上层提供的是**可靠服务**，就会采取其他措施，确保接收方主机还可以重新收到被丢弃的这个帧的正确副本。

**尽管误码是不能完全避免的，但若能实现发送方发送什么，接收方就能收到什么，就称为可靠传输**。





**使用广播信道的数据链路层 (共享式局域网)**：

除了以上三个问题外，使用广播信道的数据链路层还有其他需要解决的问题。

1. 当主机A需要发送数据给主机C，那么主机C如何知道数据是发送给自己的呢？其他主机又如何知道数据不是发送给自己的呢？

   - 可以将帧的目的地址添加在帧中一起传输

   ![image-20220315122021984](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802299.png)

2. 当总线上多台主机同时使用总线来传输帧时，传输信号会产生碰撞，这是采用广播信道的共享式局域网不可避免地。

   - 以太网采用地是一种特殊地协议CSMA/CD(载波监听多点接入/碰撞检测)

   ![image-20220315122416639](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802300.png)





**交换式局域网**：使用点对点链路和链路层交换机，在有线(局域网)领域已完全取代了共享式局域网。

![image-20220315122718256](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802301.png)



**无线局域网**：使用共享信道技术

![image-20220315122827434](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802302.png)





## ※3.2 封装成帧

### 3.2.1 什么是帧

- 数据链路层给上层交付地协议数据单元添加帧头和帧尾使之成为帧

  - 帧头和帧尾中包含有重要的控制信息
  - 帧头和帧尾的作用之一就是==帧定界==

  ![image-20220315124341716](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802303.png)

发送方的数据链路层将上层交付下来的协议数据单元封装成帧后，还要通过物理层，将构成帧的各比特，转换成电信号交给传输媒体，那么接收方的数据链路层如何从物理层交付的比特流中提取出一个个的帧？

答：例如PPP帧：需要帧头和帧尾来做**帧定界**

![image-20220315124802003](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802304.png)



但并不是每一种数据链路层协议的帧都包含有帧定界标志，例如MAC帧：

![image-20220315124835434](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802305.png)

> 前导码
>
> - 7个字节是前同步码，作用是使接收方的时钟同步
> - 之后的一字节为帧开始定界符，表明其后面紧跟着的就是MAC帧

另外以太网还规定了帧间间隔为96比特时间，因此，MAC帧不需要帧结束定界符

![image-20220315125232887](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802306.png)





### 3.2.2 透明传输

> **透明**：指某一个实际存在的事物看起来却好像不存在一样。

透明传输是指**数据链路层对上层交付的传输数据没有任何限制**，好像数据链路层不存在一样。

帧界定标志也是个特定数据值，如果在上层交付的协议数据单元中， 恰好也包含这个特定数值，接收方就不能正确接收。接收方在收到第一个帧定界标志时，认为这是帧的开始。这并没有错误，当接收方再次接收到帧定界标志时，会误认为帧结束了，如果数据链路层不采取任何措施，来避免接收方对帧是否结束的误判，就不能称为透明传输。所以数据链路层应该对上层交付的数据有限制，其内容不能包含帧定界符的值。

![image-20201011113207944](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251809173.png)



> 解决透明传输问题

**实现透明传输的方法**：

1. 面向字节的物理链路使用**字节填充**（或称**字符填充**）

   - 在发送帧之前，对帧的数据部分进行扫描，每出现一个帧定界符，就在前面插入一个转义字符。

     - 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面**插入一个转义字符“ESC”**(其十六进制编码是1B)。
     - 接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。
     - 如果转义字符也出现在数据当中，那么应在转义字符前面插入一个转义字符 ESC。当接收端收到连续的两个转义字符时，就删除其中前面的一个。

     ![image-20201011113804721](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251809168.png)

2. 面向比特的物理链路使用比特填充的方法实现透明传输

   - 如果在帧的数据部分，出现了两个帧定界标志，但它们实际上是数据，而不是帧定界，在发送前，可以采用零比特填充法，每5个连续的比特1后面就插入1个比特0。这样就确保了帧定界在整个帧中的唯一性，可以实现透明传输。
   - 接收方的数据链路层，从物理层交付的比特流中提取帧时，将帧的数据部分中的每5个连续的比特1后面的那个比特0剔除即可。

   ![image-20220315162954360](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802307.png)



**帧的数据部分长度**：

![image-20201011115008209](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251809985.png)



练习题

![image-20220315131543635](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802308.png)





## 3.3 差错检测

- 实际的通信链路都不是理想的，比特在传输过程中可能会产生差错：1可能会变成0，
  而0也可能变成1。这称为==比特差错==。
- 在一段时间内，传输错误的比特占所传输比特总数的比率称为==误码率BER==(Bit Error Rate)。
- 使用==差错检测码==来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一。

![image-20220315163728714](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802309.png)



### 3.3.1 奇偶校验

- 在待发送的数据后面==添加1位奇偶校验位==，使整个数据(包括所添加的校验位在内)中==“1" 的个数==为奇数(奇校验)或偶数(偶校验)。
- 如果有==奇数个位发生误码==，则奇偶性发生变化，==可以检查出误码==;
- 如果有==偶数个位发生误码==，则奇偶性不发生变化，==不能检查出误码(漏检)==;

![image-20220315163934774](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802310.png)

由于奇偶校验的漏检率比较高，因此数据链路层一般不会采用这种检测方法。



### ※3.3.2 循环冗余校验CRC(Cyclic Redundancy Check)

- 收发双方约定好一个==生成多项式G(x)==;
- 发送方基于待发送的数据和生成多项式计算出差错检测码(==冗余码==)，将其添加到待传输数据的后面一起传输;
- 接收方通过生成多项式来计算收到的数据是否产生了误码;

![image-20220315164103907](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802311.png)

![image-20220315164120175](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802312.png)



例题：

![image-20220315164151414](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802313.png)



![image-20220315164216141](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802314.png)



**总结：**

- ==检错码==只能检测出帧在传输过程中出现了差错，但并不能定位错误，因此==无法纠正错误==。
- 要想纠正传输中的差错，可以使用冗余信息更多的==纠错码==进行==前向纠错==。但纠错码的开销比较大，在==计算机网络中较少使用==。
- ==循环冗余校验CRC==有很好的检错能力(==漏检率非常低==)，虽然计算比较复杂，但==非常易于用硬件实现==，因此被==广泛应用于数据链路层==。
- 在计算机网络中通常采用我们后续课程中将要讨论的==检错重传方式来纠正传输中的差错，或者仅仅是丢弃检测到差错的帧==，这取决于数据链路层向其上层提供的是可靠传输服务还是不可靠传输服务。





## 3.4 可靠传输

### 3.4.1 可靠传输的基本概念

- 使用==差错检测技术==(例如循环冗余校验CRC)，接收方的数据链路层就可检测出帧在
  传输过程中是否产生了==误码==(比特错误)。

  ![image-20220315165241245](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802315.png)

- 检测出比特差错后，接下来怎么处理，取决于数据链路层向上层提供的服务类型：

  - ==不可靠==传输服务：==仅仅丢弃有误码的帧==，其他什么也不做
  - ==可靠==传输服务：想办法实现==发送端发送什么，接收端就接收什么==

- 一般情况下，==有线链路==的误码率比较低，为了减小开销，并==不要求数据链路层==向上提供==可靠==传输服务。即使出现了误码,可靠传输的问题由其上层处理。

- ==无线链路==易受干扰，误码率比较高，因此==要求数据链路层==必须向上层提供==可靠传输==服务。

![image-20220315170121547](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802316.png)







**其他传输差错：**

- ==比特差错==只是传输差错中的一种。

- 从整个计算机网络体系结构来看，传输差错还包括==分组丢失==、==分组失序==以及==分组重复==。

  - 分组丢失：路由器输入队列快满了，主动丢弃收到的分组

    ![image-20220315170635109](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802317.png)

  - 分组失序：数据并未按照发送顺序依次到达接收端，也就是说最先发送的分组未必最先到达

    ![image-20220315170924599](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802318.png)

  - 分组重复：由于某些原因，有些分组在网络中滞留了，没有及时到达接收端，这可能会造成发送端对该分组的重发，重发的分组到达接收端，但一段时间后，滞留在网络的分组也到达了接收端，这就造成**分组重复**的传输差错

    ![image-20220315171049890](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802320.png)

- 分组丢失、分组失序以及分组重复这些传输差错，一般不会出现在数据链路层，而会
  出现在其上层。

- ==可靠传输服务并不仅局限于数据链路层==，其他各层均可选择实现可靠传输。

  ![image-20220315171158588](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802321.png)

- 可靠传输的实现比较复杂，开销也比较大，是否使用可靠传输取决于应用需求



### 3.4.2 三种可靠协议

- 停止-等待协议SW
- 回退N帧协议GBN
- 选择重传协议SR

> 这三种可靠传输实现机制的基本原理并不仅限于数据链路层，可以应用到计算机网络体系结构的各层协议中



#### 停止-等待协议SW

**确认与否认：**

发送方给接收方发送数据分组，接收方收到后对其进行差错检测，若没有误码，则接收该数据分组，并给发送方发送==确认分组==，简称为==ACK==。发送方收到接收方发送的确认分组后，才能发送下一个数据分组。

假设数据分组在发送过程中出现了误码，接收方收到后对其进行差错检测，发现了误码，则丢弃该数据分组，并给发送方发送==否认分组==，简称==NAK==。发送发收到对所发送的数据分组的否认分组后，就知道了自己之前所发送的分组出现了差错而被接收方拒绝，于是立刻重传该数据分组。

发送方每发送完一个数据分组后 ，并不能立刻将该数据分组从缓存中删除，只有收到接收方的确认分组后，才能将其从缓存中删除。

![image-20220321094830513](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802322.png)

**超时重传：**

![image-20220321095047084](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802323.png)



**确认丢失：**

既然发送方发送的数据分组可能丢失，那么接收方发送的确认或否认分组就也有可能丢失。例如发送方发送了一个数据分组，接收方正确接收该数据分组后给发送方发送确认分组，但该确认分组在传输过程中丢失了。这必然会造成发送方对之前所发送数据分组的超时重传。假设这个重传的数据分组也正确到达了接收方，那么现在问题来了，接收方如何判断该数据分组是否是一个重复的分组呢？
![image-20220321095349992](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802324.png)

![image-20220321095414174](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802325.png)



既然数据分组需要编号，确认分组是否需要编号？要。如下图所示：

发送方发送0号数据分组。接收方正确接收后，给发送方发送确认分组。由于某些原因，该确认分组迟到了，这必然会导致发送方对0号数据分组的超时重传。在重传的0号数据分组的传输过程中，发送方收到了迟到的确认分组，于是发送1号数据分组。接收方收到重传的0号数据分组后发现这是一个重复的数据分组，并针对该数据分组，给发送方发送确认分组，以免发送方再次超时重传该数据分组。

![image-20220321100010084](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802326.png)

现在问题来了，我们可以非常清楚的看到，这是一个对0号数据分组的重复确认，但是发送方又如何知道呢？如果不采取其他措施的话，发送方会误认为这是对1号数据分组的确认。如果对确认分组也进行编号，就可以使发送方避免这种误判。

![image-20220321095814101](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802327.png)

> 该数据分组与之前序号为0的那个数据分组不是同一个数据分组。我们用给确认分组编号的方法解决了确认迟到所导致的重复确认，需要说明的是，对于数据链路层的点对点信道往返时间比较固定，不会出现确认迟到的情况。因此，如果只在数据链路层实现停止等待协议，可以不用给确认分组编号。





**注意事项**：

- 接收端检测到数据分组有误码时，将其丢弃并等待发送方的超时重传。但对于误码率较高的点对点链路，为使发送方==尽早重传==，也可给==发送方发送NAK分组==。
- 为了让接收方能够判断所收到的数据分组是否是重复的，需要给==数据分组编号==。由于停止等待协议的停等特性，==只需1个比特编号==就够了，即编号0和1.
- 为了让发送方能够判断所收到的ACK分组是否是重复的，需要给==ACK分组编号==，所用比特数量与==数据分组编号所用比特数量一样==。数据链路层一般不会出现ACK分组迟到的情况，因此在==数据链路层实现停止-等待协议可以不用给ACK分组编号==。
- 超时计时器设置的==重传时间==应仔细选择。一般可将重传时间选为==略大于 " 从发送方到接收方的平均往返时间 "==。
  - 口在数据链路层点对点的往返时间比较确定，重传时间比较好设定。
  - 口然而在运输层，由于端到端往返时间非常不确定，设置合适的重传时间有时并不容易。



**停止-等待协议的信道利用率：**

假设收发双方之间是一条直通的信道

- **TD**：是发送方发送数据分组所耗费的发送时延
- **RTT**：是收发双方之间的往返时间
- **TA**：是接收方发送确认分组所耗费的发送时延

TA一般都远小于TD，可以忽略，当RTT远大于TD时，信道利用率会非常低

![image-20220321100754247](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802328.png)

举例说明：

![image-20220321100835021](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802329.png)

- ==当往返时延RTT远大于数据帧发送时延To时(例如使用卫星链路)，信道利用率非常==低。
- 若出现重传，则对于传送有用的数据信息来说，信道利用率还要降低
- 为了克服停止-等待协议信道利用率很低的缺点，就产生了另外两种协议，即后退N帧协议GBN和选择重传协议SR



习题：

![image-20220321100955039](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802330.png)



> 像停止-等待协议这样通过确认和重传机制实现的可靠传输协议，常称为自动请求重传协议ARQ(**A**utomatic **R**epeat re**Q**uest)，意思是重传的请求是自动进行，因为不需要接收方显式地请求，发送方重传某个发送的分组。







#### 回退N帧协议GBN

**Why GBN**？

如图所示，发送方每发送完一个数据分组就要停止发送，并等待接收方的确认分组。当收到接收方的确认分组后，才能发送下一个数据分组，如此反复进行，从图中可以看出，发送方每发送完一个数据分组，就至少要等待一个收发双方之间的往返时间，当往返时间较大时。例如卫星链路，停止等待协议的信道利用率很低，若出现超时重传，则信道利用率更低。
![image-20220321101624819](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802332.png)

如果发送方在收到接收方的确认分组之前，可以连续发送多个数据分组则可大大提高信道利用率，这是一种流水线式的传输。

就本例而言，同等条件下，在相同的时间内使用停止等待协议的发送方只能发送一个数据分组，而采用流水线传输的发送方可以发送五个数据分组。



**回退N帧协议在流水线传输的基础上，利用发送窗口来限制发送方可连续发送数据分组的个数**

![image-20220321101904583](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802334.png)

序号落在==发送窗口==内的这五个数据分组可以==连续发送==，而序号落在发送窗口外的数据分组不允许发送。

接收窗口的尺寸即为Wr，对于回退N帧协议，其取值只能为1，这一点与停止等待协议是相同的。序号落在接收窗口内的这个数据分组允许接收，而序号落在接收窗口外的数据分组不允许接收。



**无差错情况流程：**

1. 发送方将序号落在发送窗口内的0~4号数据分组，依次连续发送出去

   ![image-20220321102244453](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802335.png)

2. 他们经过互联网传输正确到达接收方(无乱序和误码)

3. 接收方按序接收它们，每接收一个，接收窗口就向前滑动一个位置，并给发送方发送针对所接收分组的确认分组，再通过互联网的传输正确到达了发送方

   ![image-20220321102254932](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802336.png)

4. 接收方每接收一个发送窗口就向前滑动一个位置，这样就有新的序号落入发送窗口，发送方可以将收到确认的数据分组从缓存中删除了，而接收方可以择机将已接收的数据分组交付上层处理。

   ![image-20220321102307264](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802337.png)



**累计确认：**

使用回退N帧协议的接收方可以采用累计确认的方式

![image-20220321110230601](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802338.png)

举例说明：发送方将序号落在发送窗口内的0到4号数据分组依次连续发送，他们经过互联网的传输，正确到达了接收方。接收方按序接收他们，当接收完0号和1号数据分组后，给发送方发送了一个累计确认ACK1。当接收完2到4号数据分组后，又给发送方发送了一个累计确认ACK4。假设ACK1在传输过程中丢失了，而ACK4正确到达了发送方，发送方接收ACK4后就知道了，序号为4及之前的数据分组已被接收方正确接收了。于是将发送窗口向前滑动五个位置，这样就有新的序号落入了发送窗口。发送方可以将收到确认的数据分组从缓存中删除了，而接收方可以择机将已接收的数据分组交付上层处理。



优点：

- 即使确认分组丢失，发送方也可能不必重传
- 减小接收方的开销
- 减小对网络资源的占用

缺点：

- 不能向发送方及时反映出接收方已经正确接收的数据分组信息





**有差错情况：**

例如：在传输数据分组时，5号数据分组出现误码，接收方通过数据分组中的检错码发现了错误![image-20220321110548044](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802339.png)

于是丢弃该分组，而后续到达的这剩下四个分组与接收窗口的序号不匹配

![image-20220321110627154](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802340.png)

接收同样也不能接收它们，将它们丢弃，并对之前按序接收的最后一个数据分组进行确认，发送ACK4，**每丢弃一个数据分组，就发送一个ACK4**

![image-20220321110702702](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802341.png)

当收到重复的ACK4时，就知道之前所发送的数据分组出现了差错，于是可以不等超时计时器超时就立刻开始重传，具体收到几个重复确认就立刻重传，根据具体实现决定

![image-20220321110726818](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802342.png)

如果收到这4个重复的确认并不会触发发送立刻重传，一段时间后。超时计时器超时，也会将发送窗口内以发送过的这些数据分组全部重传

![image-20220321110804397](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802343.png)



接下来看看若WT超过取值范围，例如WT=8，会出现什么情况？

![image-20220321111032417](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802344.png)

对于本例采用三个比特给分组编序号，WT 的最大值为2^3减1，也就是7。我们故意超过该上限，将WT 取值为8，发送方将序号落在发送窗口内的0至7号，这8个数据分组依次连续发送出去。他们经过互联网的传输，正确到达了接收方，接收方按序正确接收他们后。给发送方发回累计确认ACK7，假设ACK7在传输过程中丢失了，这将导致发送方的超时重传，重传的0至7号数据分组到达接收方。现在问题来了，接收方根据当前接收窗口内的序号，会对这8个数据分组按序接收。但是接收方之前已经接收过这8个数据分组了，现在是在==重复接收==，也就是说，接收方==无法分辨**新旧**分组==(都是从0-7)，进而会产生分组重复这种传输差错。因此，发送窗口的尺寸不能超过其上限。



总结：

![image-20220321111709167](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802345.png)

- 回退N帧协议在流水线传输的基础上利用发送窗口来限制发送方连续发送数据分组的数量，是一种连续ARQ协议
- 在协议的工作过程中发送窗口和接收窗口不断向前滑动，因此这类协议又称为滑动窗口协议
- 由于回退N帧协议的特性，当通信线路质量不好时，其信道利用率并不比停止-等待协议高



习题：

![image-20220321111814287](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802346.png)





#### 选择重传协议SR

![image-20220321112337511](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802347.png)

过程描述：

如图所示，序号落在接收窗口内的这四个数据分组允许接收，而序号落在接收窗口外的数据分组不允许接收。发送方将序号落在发送窗口内的这四个数据分组依次连续发送出，他们经过互联网的传输，陆续到达接收方，但其中的2号数据分组丢失了。只要序号落入接收窗口内，且无码的数据分组接收方都会接收。

![image-20210415093622494](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807768.png)

接收方接收0号和1号数据分组，并发送0号和1号确认分组。接收窗口向前滑动两个位置，这样就有4和5这两个新的序号落入接收窗口，接收方接收3号数据分组并发送3号确认分组。但接收窗口不能向前滑动，因为3号数据分组是未按顺序到达的数据分组，这些确认分组经过互联网的传输，陆续到达发送方。发送方每按序收到一个确认分组发送窗口，就向前滑动一个位置，发送方接收0号和1号确认分组，发送窗口向前滑动两个位置，这样就有4和5这两个新的序号落入发送窗口。

![image-20210415093810025](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807160.png)

发送方将序号落入发送窗口的4号和5号数据分组发送出去，发送方现在可以将已经收到确认的0号和1号数据分组，从发送缓存中删除了，而接收方可择机将以按需接收的0号和1号数据分组交付上层处。发送方接收3号确认分组，但发送窗口不能向前滑动，因为这是一个未按顺序到达的确认分组，发送方还未收到他之前的2号确认分组。不过需要记录3号数据分组已收到确认，这样该数据分组就不会超时重发。

4号和5号数据分组到达接收方，接收方接收他们并发送4号和5号确认分组，但接触窗口不能向前滑动，因为他们是未按顺序到达的数据分组，接收方还未收到他们之前的2号数据分组，假设在4号和5号确认分组的传输过程中，发送方针对2号数据分组的重传计时器超时了，发送方重传2号数据分组，4号和5号确认分组陆续到达发送方，发送方接收他们，但发送窗口不能向前滑动，因为他们是未按顺序到达的确认分组，发送方还未收到他们之前的2号确认分组，不过需要记录4号和5号数据分组已收到确认。这样他们就不会超时重发，发送方之前重传的2号数据分组到达接收方，接收方接收该数据分组并发送2号确认分组，接收窗口现在可以向前滑动4个位置，这样就有6,7,0,1这4个新的序号落入接收窗口，2号确认分组经过互联网的传输到达发送方，发送方接收该确认分组，发送窗口现在可以向前滑动4个位置，这样就有6,7,0,1这4个新的序号落入发送窗口，发送方现在就可以继续将这4个序号的数据分组依次发送出去了。

![image-20210415093923287](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807392.png)

注意：

![image-20220321113941912](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802348.png)



若发送窗口的取值超过了2^n-1^，也会出现接收方无法分辨新、旧数据分组的情况，如下所示：

同样采用3个比特给分组编序号（0-7），由公式可知WT最大取值为4，我们故意将WT取为5，相应的接收窗口的尺寸WR也设置为5

假设接收方成功接收到5个数据分组，接收窗口向前滑动5位，这样就有5，6，7，0这五个新的序号落入接收窗口

![image-20220321114625947](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802349.png)

假设确认分组在传输过程中丢失了0号，发送方收到分组后，标记1-4号分组已被接受，但是发送窗口不能向前移动，因为0号数据分组丢失了，这是一个未按顺序到达的数据分组。直到0号数组分组的重传计时器超时，发送方接着重传0号数据分组。

当0号数据分组到达接收方时，序号0落在接收窗口内，接收方会接受它，但是，接收方之前已经确认接收过该数据分组了，如果现在还要接收，就会出现分组重复这种传输差错。

![image-20220321115357365](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802350.png)





总结：

![image-20220321114005900](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802351.png)

习题：

![image-20220321115448494](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802352.png)





## 3.5 点对点协议PPP

请大家想想看,一般的英特网用户是如何接入到英特网的呢,通常都是要通过连接到某个因特网服务提供者ISP。例如中国电信、中国联通、中国移动这三大运营商,才能接入英特网。这些ISP已经从因特网管理机构申请到了一批IP地址，用户计算机只有获取到ISP 所分配的合法IP地址后，才能成为英特网上的主机。用户计算机与ISP进行通信时，所使用的数据链路层协议通常就是PPP协议。这里需要说明的是，在1999年公布的在以太网上运行的PPP 协议，即PPP over，简称为PPPoE 它使得ISP 可以通过dsl 电路、调制解调器、以太网等宽带接入技术。以以太网接口的形式为用户提供接入服务。
![image-20201012210844629](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807353.png)

- 点对点协议PPP（Point-to-Point Protocol）是目前使用最广泛的点对点数据链路层协议
- PPP协议是因特网工程任务组IEIF在1992年制定的。经过1993年和1994年的修订，现在的PPP协议已成为因特网的正式标准[RFC1661，RFC1662]
- 特点：简单；只检测差错，而不是纠正差错；不使用序号，也不进行流量控制；可同时支持多种网络层协议
  

![image-20201012211423528](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807202.png)



**帧格式：**

必须规定特殊的字符作为帧定界符

![image-20201012211826281](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807024.png)

真尾部中的帧检验序列FCS字段，其值是使用循环冗余校验CRC 计算出的校验位，用于检查PPP帧是否存在误码。



**透明传输：**

当PPP帧的数据部分出现帧首和帧尾中的标志字段时，如果不采取措施，则会造成接收方对PPP帧是否结束的误判。因为标志字段是PPP帧的定界符，取值为十六进制的7E。

![image-20210416093637579](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807648.png)



实现透明传输的方法：

- 面向字节的异步链路：字节填充法（插入“转义字符”）

  ![image-20201012212148803](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807372.png)

- 面向比特的同步链路：比特填充法（插入“比特0”）

  ![image-20201012212255550](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807754.png)



**差错检测：**

接下来我们来看看PPP协议是如何进行差错检测的，PPP 帧的尾部包含有一个两字节的帧检验序列FCS 字段，使用循环冗余校验CRC 来计算该字段的取值。采用的生成多项式如下所示：

![image-20201012212558654](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807489.png)



**工作状态：**

- 当用户拨号接入 ISP 时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。
- PC 机向路由器发送一系列的 LCP 分组（封装成多个 PPP 帧）。
- 这些分组及其响应选择一些 PPP 参数，并进行网络层配置，NCP 给新接入的 PC 机
- 分配一个临时的 IP 地址，使 PC 机成为因特网上的一个主机。
- 通信完毕时，NCP 释放网络层连接，收回原来分配出去的 IP 地址。接着，LCP 释放数据链路层连接。最后释放的是物理层的连接。

![image-20201012213021860](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807257.png)

> 可见，PPP协议已经不是纯粹的数据链路层的协议，他还包含了物理层和网络层的内容





## 3.6 媒体接入控制

**数据链路层的两个子层：**

为了使数据链路层能更好地适应多种局域网标准，IEEE 802 委员会就将局域网的数据链路层拆成两个子层：

- 逻辑链路控制 LLC（Logical Link Control）子层；
- 媒体接入控制 MAC（Medium Access Control）子层。

与接入到传输媒体有关的内容都放在 MAC子层，而 LLC 子层则与传输媒体无关。
不管采用何种协议的局域网，对 LLC 子层来说都是透明的。

![image-20201013201133903](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807111.png)



### 3.6.1 基本概念

为什么需要媒体接入控制（介质访问控制）？

**共享信道带来的问题：**

若多个设备在共享信道上同时发送数据，则会造成彼此干扰，导致发送失败

![image-20201013152007335](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807324.png)

**媒体接入控制分为两大类：**

- 静态划分信道
- 动态接入控制

![image-20201013152453425](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807618.png)

> 随着技术的发展，交换技术的成熟和成本的降低，具有更高性能的使用点对点链路和链路层交换机的交换式局域网在有线领域已完全取代了共享式局域网，但由于无线信道的广播天性，无线局域网仍然使用的是共享媒体技术。





### 3.6.2 静态划分信道

**信道复用：**

- ==复用==（Multiplexing）是通信技术中的一个重要概念。复用就是通过==一条物理线==路==同时==传输==多路用户的信号==
- 当网络传输媒体的传输容量大于多条==单一信道==传输的总通信量时，可利用复用技术在一条物理线路上建立多条通信信道来充分利用传输媒体的带宽

![image-20220321131320041](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802353.png)

**信道复用的分类：**

- 频分复用FDM
- 时分复用TDM
- 波分复用WDM
- 码分复用CDM



**频分复用FDM (Frequency Division Multiplexing)**：

- 将整个带宽分为多份，用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。
- **频分复用**的所有用户在同样的时间**占用不同的带宽资源**（请注意，这里的“带宽”是频率带宽而不是数据的发送速率）。

如图所示，这是三对用户各自使用一条独立的物理线路进行通信。如果在发送端使用复用器，在接收端，在使用分用器，这三个用户就可以共享一条物理线路进行通信。

![image-20201013153947668](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251807955.png)



**时分复用TDM (Time Division Multiplexing)**

- 时分复用则是将时间划分为一段段等长的**时分复用帧（TDM帧）**。每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙。
- 每一个用户所占用的时隙是**周期性**地出现（其周期就是TDM帧的长度）的。
- TDM 信号也称为**等时** (isochronous) 信号。
- **时分复用的所有用户在不同的时间占用同样的频带宽度。**

![image-20201013154142540](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806999.png)



**波分复用 WDM(Wavelength Division Multiplexing)**

![image-20201013202218132](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806829.png)

> 波分复用就是光的频分复用，使用一根光纤来同时传输多个光载波信号
>
> 光信号传输一段距离后衰减，所以要用 掺铒光纤放大器 放大光信号



**码分复用 CDM (Code Division Multiplexing)**

![image-20201013203126625](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/c7920ce016331ffcae2554cbec5006d4.png)

![image-20220321133154377](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802354.png)

![image-20210419085308525](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806069.png)

![image-20210419085456412](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806654.png)





### 3.6.3 动态接入控制

- **受控接入：在局域网中使用得较少，本书不再讨论**
- **随机接入：重点**



#### 随机接入（CSMA/CD协议）

总线局域网使用协议：CSMA/CD



**1、基本概念：**

**最初**的**以太网**是将许多计算机都连接到一根总线上。易于实现广播通信。当初认为这样的连接方法既简单又可靠，因为总线上没有有源器件。

> **以太网（Ethernet）**是一种计算机**局域网技术**。IEEE组织的IEEE 802.3标准制定了**以太网（Ethernet）**的技术标准
>
> 以太网采用无连接的工作方式，对发送的数据帧不进行编号，也不要求对方发回确认。目的站收到有差错帧就把它丢弃，其他什么也不做

![image-20201013211620687](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806908.png)

![image-20201013213102777](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806368.png)

96比特时间是指发送96比特所耗费的时间，也称为帧间最小间隔，其作用是是接收方可以检测出一个帧的结束，同时也使得所有其他站点都能有机会平等竞争信道并发送帧。



**2、多址接入MA：**

- 许多主机以多点接入的方式连接在一根总线上

  ![image-20201013215400688](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806386.png)



**3、载波监听CS：**

- 每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。

- 假设主机B要发送帧，他首先进行监听，检测到总线空闲96比特时间后就可以发送帧了。

  ![image-20201013215530979](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806878.png)

- 总线上并没有什么“ 载波 ”。因此， **“载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号。**





**4、碰撞检测CD：**

- “碰撞检测”就是计算机**边发送数据边检测**信道上的信号电压大小
- 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）
- 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。所谓“碰撞”就是发生了冲突。因此“碰撞检测”也称为“冲突检测”
- 在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来
- 每一个正在发送数据的站，一旦发现总线上出现了**碰撞**，就要立即**停止发送**，免得继续浪费网络资源，然后等待一段随机时间后再次发送



示例流程：

假设在主机C使用总线发送帧的过程中，主机B 也要发送帧，主机B进行载波监听。发现总线忙于是持续检测总线，一旦发现总线空闲96比特时间则立即发送帧，边发送帧，，还要边检测碰撞，只要没检测到碰撞，则可继续发送帧的剩余部分。假设在主机B 发送帧的过程中，主机C 也要发送帧，主机C 进行载波监听，发现总线空闲96比特时间后立即发送帧。这必然会产生碰撞，在产生碰撞的时刻，主机B 和主机C都在边发送帧砭检测碰撞，但都检测不到碰撞，碰撞信号沿总线传播，主机C会比主机B 更早检测到碰撞并停止发送，退避一段随机时间后。重新在发送之前所发送的帧，当主机B检测到碰撞后，立即停止发送。退避一段随机时间，重新在发送之前所发送的帧。
![image-20201013221240514](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806822.png)



> 为什么要进行碰撞检测？
>
> 因为信号传播时延对载波监听产生了影响

![image-20220321152529175](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802356.png)

A 需要单程传播时延的 2 倍的时间，才能检测到与 B 的发送产生了冲突



**5、CSMA/CD协议工作流程：**

![image-20201013221705893](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806618.png)

**6、CSMA/CD协议工作 — 争用期（碰撞窗口）**

![image-20220321162117074](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802357.png)



**7、CSMA/CD 协议工作 — 最小帧长**

假设主机A 正在给主机D 发送一个很短的帧，边发送边检测碰撞，主机A 很快就将该帧发送完毕了，之后就不再针对该帧检测碰撞。

在该帧的传输过程中，主机C也要发送帧，主机C 检测到总线空闲96比特时间后就立即发送帧，尽管总线实际上并不空闲，这必然会产生碰撞。

主机D 最终会收到主机A 发送的并遭遇碰撞的帧，主机D会将该帧丢弃，但对于主机A 而言，他并不知道自己已发送完毕的该帧在总线上传输的过程中遭遇了碰撞，因此不会重发该帧，很显然，使用CSMA/CD 协议的以太网的帧长不能太短。

![image-20201013224051932](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806376.png)



**8、CSMA/CD 协议工作 — 最大帧长**

![image-20220321162601844](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802358.png)



**9、CSMA/CD 协议工作——截断二进制指数退避算法**

![image-20220321162911118](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802359.png)



**10、CSMA/CD 协议工作 — 信道利用率**

![image-20201013231430295](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251806865.png)



**11、CSMA/CD 协议工作 — 帧接收发送流程**

![image-20210419092656559](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802360.png)







> CSMA/CD协议曾经用于各种总线结构以太网和双绞线以太网的早起版本中。
>
> **现在的以太网基于交换机和全双工连接，不会有碰撞，因此没有必要使用CSMA/CS协议**





习题：

![image-20220321163331387](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802361.png)

![image-20210419093002663](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251805171.png)

![image-20220321164252649](https://run-notes.oss-cn-beijing.aliyuncs.com/notes/202203251802362.png)





#### 随机接入（CSMA/CA协议）































